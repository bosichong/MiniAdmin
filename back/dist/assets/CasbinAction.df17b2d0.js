import{a as w,r as k,k as P,b as c,o as U,d as I,c as t,w as a,F as H,g as _,e as v,f as y,j as J,M as s,E as K}from"./index.a51140a0.js";import{E as L,D as Q}from"./EditFilled.252faa9b.js";const R={key:0},Z={__name:"CasbinAction",setup(W){const n=w({ca_id:0,name:"",action_key:"",description:""}),p=k(!1),E=P(()=>!(n.name&&n.action_key&&n.description)),O=o=>{_.get("/v1/ca/get_ca",{params:{ca_id:o}}).then(function(e){n.name=e.data.name,n.action_key=e.data.action_key,n.description=e.data.description,n.ca_id=o,p.value=!0})},D=()=>{p.value=!1},T=()=>{_.post("/v1/ca/update_ca",{old_ca_id:n.ca_id,name:n.name,action_key:n.action_key,description:n.description}).then(function(o){o.data?s.info().update({title:"\u63D0\u793A!",content:"\u4FEE\u6539\u6210\u529F!",onOk:()=>{p.value=!1,f()}}):s.error().update({title:"\u9519\u8BEF!",content:"\u4FEE\u6539\u5931\u8D25!"})}).catch(function(o){s.error().update({title:"\u9519\u8BEF!",content:"\u4FEE\u6539\u5931\u8D25!"+o.response.data.detail})})},q=o=>{s.confirm({title:"\u786E\u5B9A\u8981\u5220\u9664\u5417?",icon:t(K),content:"\u786E\u5B9A\u540E\u4F1A\u5220\u9664\u6B64\u8D44\u6E90\u53CA\u5176\u76F8\u5173\u7684\u6743\u9650!",okText:"\u786E\u5B9A",okType:"danger",cancelText:"\u53D6\u6D88",onOk(){_.get("v1/ca/delete_ca",{params:{ca_id:o}}).then(function(e){e.data&&(f(),s.info().update({title:"\u63D0\u793A!",content:"\u5220\u9664\u6210\u529F!"}))}).catch(function(e){s.error().update({title:"\u63D0\u793A!",content:"\u4FEE\u6539\u5931\u8D25!"+e.response.data.detail})})},onCancel(){console.log("Cancel")}})},i=w({name:"",action_key:"",description:""}),C={name:[{required:!0,message:"Please enter name"}],action_key:[{required:!0,message:"Please enter action_key"}],description:[{required:!0,message:"Please enter description"}]},u=k(!1),N=()=>{u.value=!0},V=()=>{u.value=!1},b=()=>{_.post("/v1/ca/create_ca",{name:i.name,action_key:i.action_key,description:i.description,user_id:sessionStorage.getItem("user_id")}).then(function(o){o.data?s.info().update({title:"\u63D0\u793A!",content:"\u521B\u5EFA\u6210\u529F!",onOk:()=>{u.value=!1,f()}}):s.error().update({title:"\u9519\u8BEF!",content:"\u521B\u5EFA\u5931\u8D25!"}),i.name="",i.action_key="",i.description=""}).catch(function(o){o&&s.error().update({title:"\u9519\u8BEF!",content:o.response.data.detail,onOk:()=>{u.value=!1,i.name="",i.action_key="",i.description=""}})})},z=o=>{console.log("Failed:",o)},B=P(()=>!(i.name&&i.action_key&&i.description)),M=k([{title:"Id",dataIndex:"id",key:"id"},{title:"\u540D\u79F0",dataIndex:"name",key:"name"},{title:"\u52A8\u4F5Ckey",dataIndex:"action_key",key:"action_key"},{title:"\u7B80\u4ECB",key:"description",dataIndex:"description"},{title:"\u7BA1\u7406",key:"action"}]),g=k([]),f=()=>{_.get("v1/ca/get_cas").then(function(o){g.value=o.data}).catch(function(o){console.log(o)})};return f(),(o,e)=>{const d=c("a-button"),$=c("a-space"),j=c("a-card"),A=c("a-divider"),S=c("a-table"),r=c("a-input"),m=c("a-form-item"),x=c("a-form"),F=c("a-drawer");return U(),I(H,null,[t(j,{style:{"margin-bottom":"10px"}},{default:a(()=>[t($,null,{default:a(()=>[t(d,{type:"primary",onClick:N},{default:a(()=>[v("\u521B\u5EFA\u52A8\u4F5C")]),_:1})]),_:1})]),_:1}),t(S,{columns:M.value,"data-source":g.value},{headerCell:a(({columns:l})=>[]),bodyCell:a(({column:l,record:h})=>[l.key==="action"?(U(),I("span",R,[t(d,{type:"primary",size:"small",onClick:G=>O(h.id)},{icon:a(()=>[t(y(L))]),_:2},1032,["onClick"]),t(A,{type:"vertical"}),t(d,{type:"primary",size:"small",onClick:G=>q(h.id)},{icon:a(()=>[t(y(Q))]),_:2},1032,["onClick"])])):J("",!0)]),_:1},8,["columns","data-source"]),t(F,{title:"\u521B\u5EFA\u52A8\u4F5C",width:"550",visible:u.value,"onUpdate:visible":e[3]||(e[3]=l=>u.value=l)},{extra:a(()=>[t(d,{onClick:V},{default:a(()=>[v("\u53D6\u6D88")]),_:1}),t(d,{disabled:y(B),type:"primary",onClick:b},{default:a(()=>[v("\u63D0\u4EA4")]),_:1},8,["disabled"])]),default:a(()=>[t(x,{model:i,rules:C,layout:"vertical",onFinish:b,onFinishFailed:z},{default:a(()=>[t(m,{label:"\u52A8\u4F5C\u540D\u79F0",name:"name"},{default:a(()=>[t(r,{value:i.name,"onUpdate:value":e[0]||(e[0]=l=>i.name=l),placeholder:"Please enter name"},null,8,["value"])]),_:1}),t(m,{label:"action_key",name:"action_key"},{default:a(()=>[t(r,{value:i.action_key,"onUpdate:value":e[1]||(e[1]=l=>i.action_key=l),placeholder:"Please enter action_key"},null,8,["value"])]),_:1}),t(m,{label:"\u7B80\u4ECB",name:"description"},{default:a(()=>[t(r,{value:i.description,"onUpdate:value":e[2]||(e[2]=l=>i.description=l),placeholder:"Please enter description"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"]),t(F,{title:"\u7F16\u8F91\u8D44\u6E90",width:"550",visible:p.value,"onUpdate:visible":e[8]||(e[8]=l=>p.value=l)},{extra:a(()=>[t(d,{onClick:D},{default:a(()=>[v("\u53D6\u6D88")]),_:1}),t(d,{disabled:y(E),type:"primary",onClick:T},{default:a(()=>[v("\u63D0\u4EA4")]),_:1},8,["disabled"])]),default:a(()=>[t(x,{model:n,rules:C,layout:"vertical",onFinish:b},{default:a(()=>[t(r,{value:n.ca_id,"onUpdate:value":e[4]||(e[4]=l=>n.ca_id=l),type:"hidden"},null,8,["value"]),t(m,{label:"\u8D44\u6E90\u540D\u79F0",name:"name"},{default:a(()=>[t(r,{value:n.name,"onUpdate:value":e[5]||(e[5]=l=>n.name=l),placeholder:"Please enter name"},null,8,["value"])]),_:1}),t(m,{label:"action_key",name:"action_key"},{default:a(()=>[t(r,{value:n.action_key,"onUpdate:value":e[6]||(e[6]=l=>n.action_key=l),placeholder:"Please enter action_key"},null,8,["value"])]),_:1}),t(m,{label:"\u7B80\u4ECB",name:"description"},{default:a(()=>[t(r,{value:n.description,"onUpdate:value":e[7]||(e[7]=l=>n.description=l),placeholder:"Please enter description"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])],64)}}};export{Z as default};
